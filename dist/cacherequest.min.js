var CachedRequestHelper={storageKeys:{timeout:"TIMEOUT",lastcall:"LASTCALL",response:"RESPONSE"},defaultTimeout:3e5,send:function(options){this.__prepareVariables(options);var valid=this.__isValid();valid?this.__callCachedCallback():this.__doRequest(),this.d.promise()},__prepareVariables:function(options){this.opt=options,this.d=new $.Deferred,this.__createHash(),this.__getStored()},__createHash:function(){this.hash=this.opt.url+""+(this.opt.data||"")+(this.opt.method||"-ANY")},__getStored:function(){this.stored=localStorage.getItem(this.hash),this.stored=JSON.parse(this.stored)||null},__isValid:function(){if(!this.stored)return!1;var to=this.stored[this.storageKeys.timeout],lc=this.stored[this.storageKeys.lastcall];return Date.now()-lc<to},__callCachedCallback:function(){this.opt.hasOwnProperty("success")?this.opt.success.call(this.opt.context,null,"CACHED",this.stored[this.storageKeys.response]):this.opt.hasOwnProperty("complete")&&this.opt.complete(this.opt.context,"CACHED",this.stored[this.storageKeys.response]),this.d.resolve()},__doRequest:function(){this.originalSettings={s:this.opt.success,f:this.opt.error,c:this.opt.complete,ctx:this.opt.context},this.opt.success=this.__successCallback,this.opt.error=this.__errorCallback,this.opt.complete=this.__completeCallback,this.opt.context=this,$.ajax(this.opt)},__successCallback:function(data,status,res){this.__cacheRequest(res),this.originalSettings.s?this.originalSettings.s.call(this.originalSettings.ctx,data,status,res):this.originalSettings.c&&this.originalSettings.c.call(this.originalSettings.ctx,res,status),this.d.resolve()},__errorCallback:function(res,status,err){this.originalSettings.e&&this.originalSettings.call(this.originalSettings.ctx,res,status,err),this.d.resolve()},__completeCallback:function(res,status){0===res.status&&"error"===status&&(res=this.opt.useOldIfError&&this.stored?this.stored[this.storageKeys.response]:null),this.originalSettings.c?this.originalSettings.c.call(this.originalSettings.ctx,res,status):console.error('No "complete" callback, no connection and no cache available (or you don\'t want it).'),this.d.resolve()},__cacheRequest:function(res){var data={};data[this.storageKeys.timeout]=this.opt.cacheTimeout||this.defaultTimeout,data[this.storageKeys.lastcall]=Date.now(),data[this.storageKeys.response]=res,localStorage.setItem(this.hash,JSON.stringify(data))}};